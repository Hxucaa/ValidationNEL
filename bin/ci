#!/usr/bin/env bash

set -e

TEST_CMD1=xctool -workspace ValidationNEL.xcworkspace -scheme ValidationNEL-iOS -sdk iphonesimulator9.3 build test

TEST_CMD2=xctool -workspace ValidationNEL.xcworkspace -scheme ValidationNEL-tvOS -sdk appletvsimulator9.2 build test

TEST_CMD3=xctool -workspace ValidationNEL.xcworkspace -scheme ValidationNEL-macOS -sdk macosx10.11 build

TEST_CMD4=xctool -workspace ValidationNEL.xcworkspace -scheme ValidationNEL-watchOS -sdk watchsimulator2.2 build

which -s xcpretty
XCPRETTY_INSTALLED=$?

if [[ $TRAVIS || $XCPRETTY_INSTALLED == 0 ]]; then
  eval "${TEST_CMD1} | xcpretty"
  eval "${TEST_CMD2} | xcpretty"
  eval "${TEST_CMD3} | xcpretty"
  eval "${TEST_CMD4} | xcpretty"
else
  eval "$TEST_CMD1"
  eval "$TEST_CMD2"
  eval "$TEST_CMD3"
  eval "$TEST_CMD4"
fi
